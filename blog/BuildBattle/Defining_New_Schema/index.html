<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">   
    <link rel="shortcut icon" href="../../../../favicon.ico">

    <title>Defining New Schema - Project Malm&ouml; Blog</title>

    <link href="../../css/bootstrap-custom.min.css" rel="stylesheet">
    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css" rel="stylesheet">
    <link rel="stylesheet" href="//cdn.jsdelivr.net/font-hack/2.018/css/hack.min.css">
    <link href='//fonts.googleapis.com/css?family=PT+Sans:400,400italic,700,700italic&subset=latin-ext,latin' rel='stylesheet' type='text/css'>
    <link href='//fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,700italic,400,300,600,700&subset=latin-ext,latin' rel='stylesheet' type='text/css'>
    <link href="../../css/base.css" rel="stylesheet">
    <link href="../../css/cinder.css" rel="stylesheet">
    <link rel="stylesheet" href="../../css/highlight.css">

    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->

    <script src="https://ajax.googleapis.com/ajax/libs/webfont/1.5.18/webfont.js"></script>
    <script>
    WebFont.load({
        google: {
            families: ['Open Sans', 'PT Sans']
        }
    });
    </script>

    
</head>

<body>

    <div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            

            <!-- Main title -->
            <a class="navbar-brand" href="../..">Project Malm&ouml; Blog</a>
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">
            
                <!-- Main navigation -->
                <ul class="nav navbar-nav">
                
                
                    <li >
                        <a href="../..">Home</a>
                    </li>
                
                
                
                    <li >
                        <a href="../../Getting_Started/">Getting Started</a>
                    </li>
                
                
                
                    <li class="dropdown active">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Build Battle Tutorial <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="../Introduction/">Introduction</a>
</li>

                        
                            
<li >
    <a href="../Preliminaries/">Preliminaries</a>
</li>

                        
                            
<li >
    <a href="../An_Overview_of_XML_and_XSD/">An Overview of XML and XSD</a>
</li>

                        
                            
<li class="active">
    <a href="./">Defining New Schema</a>
</li>

                        
                            
<li >
    <a href="../Java_and_MinecraftForge/">Java and MinecraftForge</a>
</li>

                        
                            
<li >
    <a href="../Creating_Schema_Implementations/">Creating Schema Implementations</a>
</li>

                        
                            
<li >
    <a href="../Defining_Simple_Functions/">Defining Simple Functions</a>
</li>

                        
                            
<li >
    <a href="../Event_Handlers/">Event Handlers</a>
</li>

                        
                            
<li >
    <a href="../Summary/">Summary</a>
</li>

                        
                        </ul>
                    </li>
                
                
                </ul>
            

            <ul class="nav navbar-nav navbar-right">
                <li>
                    <a href="#" data-toggle="modal" data-target="#mkdocs_search_modal">
                        <i class="fa fa-search"></i> Search
                    </a>
                </li>
                
                    <li >
                        <a rel="next" href="../An_Overview_of_XML_and_XSD/">
                            <i class="fa fa-arrow-left"></i> Previous
                        </a>
                    </li>
                    <li >
                        <a rel="prev" href="../Java_and_MinecraftForge/">
                            Next <i class="fa fa-arrow-right"></i>
                        </a>
                    </li>
                
                
                    <li>
                        <a href="https://github.com/Microsoft/malmo/">
                            
                                <i class="fa fa-github"></i>
                            
                            GitHub
                        </a>
                    </li>
                
            </ul>
        </div>
    </div>
</div>

    <div class="container">
        
        <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
    
        <li class="first-level active"><a href="#mission-structure">Mission Structure</a></li>
        
    
        <li class="first-level "><a href="#mission-handlers">Mission Handlers</a></li>
        
    
    </ul>
</div></div>
        <div class="col-md-9" role="main">

<h3 id="mission-structure">Mission Structure</h3>
<p>Take a look at the Mission.xsd in the Schemas folder of the 
 root directory where Malm&ouml; is installed. In there you will find 
 Schema definitions for elements that form the overall structure of 
 Missions. The general structure of a Mission XML can be inferred 
 from there and from the tutorial code examples provided as such: </p>
<pre><code class="XML">    &lt;Mission&gt; 
    &lt;About&gt;
        &lt;Summary&gt;A Summary of the Mission&lt;/Summary&gt;
        &lt;Description&gt;A more detailed Description of the Mission&lt;/Description&gt;
    &lt;/About&gt;
    &lt;ModSettings&gt;
        &lt;MsPerTick&gt;50&lt;/MsPerTick&gt;
        &lt;PrioritiseOffscreenRendering&gt;false&lt;/PrioritiseOffscreenRendering&gt;
    &lt;/ModSettings&gt; 
    &lt;ServerSection&gt; 
        &lt;ServerInitialConditions&gt;
            &lt;Time&gt; 
                &lt;StartTime&gt;1000&lt;/StartTime&gt;
                &lt;AllowPassageOfTime&gt;false&lt;/AllowPassageOfTime&gt;
            &lt;/Time&gt;
            &lt;Weather&gt;clear&lt;/Weather&gt;
            &lt;AllowSpawning&gt;false&lt;/AllowSpawning&gt;
        &lt;/ServerInitialConditions&gt;
        &lt;ServerHandlers&gt;
            &lt;!-- One of the following: 

                &lt;FlatWorldGenerator&gt;, &lt;FileWorldGenerator&gt; and 
                &lt;DefaultWorldGenerator&gt;
                    ...
                &lt;/ChosenWorldGenerator&gt; 

            --&gt; 

            &lt;!-- Some number of the following: 

                 &lt;DrawingDecorator&gt;, &lt;MazeDecorator&gt;, 
                 &lt;ClassroomDecorator&gt; and &lt;SnakeDecorator&gt;
                    ...
                 &lt;/ChosenDecorator&gt; 
            --&gt;

            &lt;!-- Some number of the following: 

                 &lt;ServerQuitFromTimeUp&gt; and 
                 &lt;ServerQuitWhenAnyAgentFinishes&gt;
                    ...
                 &lt;/ChosenQuitProducer&gt;  
            --&gt;
        &lt;/ServerHandlers&gt;
    &lt;/ServerSection&gt;
    &lt;AgentSection&gt; 
        &lt;!-- Some number of the following. 
             Note: AgentMissionHandlers are defined as a large xs:group in Mission.xsd
                   These include: Observation Producers, Reward Handlers, Command Handlers, 
                                  and Agent Quit Producers  

             &lt;AnAgentMissionHandler&gt; 
                ...
             &lt;/TheAgentMissionHandler&gt;

         --&gt;
    &lt;/AgentSection&gt;
  &lt;/Mission&gt;
</code></pre>

<p>Hopefully the above gives a good representation of what Missions look 
like in Malm&ouml;. Wherever possible, common sensible values have been 
replaced such as for the Weather and StartTime. XML comments are 
defined using <code>&lt;!--</code> and <code>--&gt;</code> with the contents within. 
The comments above talk about what is to be in place of the comments 
in the given regions of the XML document. </p>
<h3 id="mission-handlers">Mission Handlers</h3>
<p>This tutorial is focused on creating a new task, the Build Battle Task, 
and specifically for that we need a new Agent Mission Handler and in 
particular a Reward Handler.</p>
<p>Now, we will add our first line of code! Scroll to the <code>xs:group</code> named 
<code>AgentMissionHandlers</code> in the <code>Mission.xsd</code> file. There should be a section 
of code with Reward Handlers. Add an element at the end of the section 
with <code>ref</code> set to <code>RewardForStructureCopying</code> and <code>minOccurs</code> set to <code>0</code>. </p>
<p>As we have talked about in the previous section, <code>minOccurs</code> is an 
occurrence indicator that specifies the minimum number of times an 
element needs to appear (in this case in the all section of the group). 
The ref attribute references an element that is declared elsewhere, 
which may or may not be in the same schema document. Take a look at the
top of the <code>Mission.xsd</code> file. There you will see some xs:includes. We 
will be writing the schema for the <code>RewardForStructureCopying</code> element in 
<code>MissionHandler.xsd</code> where all the other RewardHandlers and indeed 
(Agent)MissionHandlers are defined.</p>
<p>After completing the above, you should have something like what is shown
below:</p>
<pre><code class="XML">    &lt;xs:element ref=&quot;RewardForTouchingBlockType&quot; minOccurs=&quot;0&quot; /&gt;
    &lt;xs:element ref=&quot;RewardForSendingCommand&quot; minOccurs=&quot;0&quot; /&gt;
    &lt;xs:element ref=&quot;RewardForCollectingItem&quot; minOccurs=&quot;0&quot; /&gt;
    &lt;xs:element ref=&quot;RewardForDiscardingItem&quot; minOccurs=&quot;0&quot; /&gt;
    &lt;xs:element ref=&quot;RewardForReachingPosition&quot; minOccurs=&quot;0&quot;/&gt;
    &lt;xs:element ref=&quot;RewardForMissionEnd&quot; minOccurs=&quot;0&quot;/&gt;
    &lt;xs:element ref=&quot;RewardForStructureCopying&quot; minOccurs=&quot;0&quot;/&gt;
</code></pre>

<p>Now, let us write the XML Schema Definition for 
<code>RewardForStructureCopying</code>. First, we open 
<code>MissionHandler.xsd</code>. Now, scroll down to the section just after 
the comment which contains the phrase "REWARD PRODUCERS."</p>
<p>To get an idea of what we will be adding first, take a look at the 
simpleType definition <code>Behavior</code>:</p>
<pre><code class="XML">&lt;xs:simpleType name=&quot;Behaviour&quot;&gt;
    &lt;xs:restriction base=&quot;xs:string&quot;&gt;
      &lt;xs:enumeration value=&quot;onceOnly&quot; /&gt;
      &lt;xs:enumeration value=&quot;oncePerBlock&quot; /&gt;
      &lt;xs:enumeration value=&quot;oncePerTimeSpan&quot; /&gt;
      &lt;xs:enumeration value=&quot;constant&quot; /&gt;
    &lt;/xs:restriction&gt;
  &lt;/xs:simpleType&gt;
</code></pre>

<p>As can be seen above, Behavior is a simpleType that restricts a string 
to take one of four possible values (an enumeration with four possible
values.) Functionally, if one looks at the naming and the Java files
associated with this Schema, Behavior specifies what is commonly 
known in reinforcement learning as reward density.</p>
<p>As the names imply: onceOnly signifies that an agent will receive a 
reward once only, oncePerBlock signifies that an agent 
will receive rewards once per block, oncePerTimeSpan specifies that 
a reward is received only once in some time span, and finally, consant 
signifies that a reward is constantly given. </p>
<p>Now, the above explanations might seem a little vague, but it should do
for what we are going to add. <code>RewardDensityForBuildAndBreak</code> is 
type very similar to <code>Behavior</code> in that it is also a reward density 
type. Ideally we should reuse types if at all possible, however; just to 
illustrate the definitions of types in XSD as well as make a more 
functional and meaning type for the particular task we are creating, 
we define this new type. Go ahead and add the following code snippet
right after the last Schema definition in the Reward Producers section.</p>
<pre><code class="XML">  &lt;xs:simpleType name=&quot;RewardDensityForBuildAndBreak&quot;&gt;
    &lt;xs:restriction base=&quot;xs:string&quot;&gt;
      &lt;xs:enumeration value=&quot;PER_BLOCK&quot;/&gt;
      &lt;xs:enumeration value=&quot;ACCUMULATED&quot;/&gt;
      &lt;xs:enumeration value=&quot;MISSION_END&quot;/&gt;
    &lt;/xs:restriction&gt;
  &lt;/xs:simpleType&gt;
</code></pre>

<p>The above simpleType definition also uses an <code>xs:restriction</code> with
the type <code>xs:string</code>. It can take one of three values, 
<code>PER_BLOCK</code> which signifies that a reward is given per block placed
or broken, <code>ACCUMULATED</code> signifying some sort of reward 
accumulation and <code>MISSION_END</code> signifying that a reward is only 
given at a mission's end. Again, these may seem like vague description, 
but they will become clear when we add the Minecraft Forge code.</p>
<p>Now, in the Build Battle, we will be comparing a given area where the 
player (agent) is to construct a structure that is already built. A 
simple way to define such areas is using a cuboid. Given that Minecraft
is comprised of voxels (individual cubes), we can describe a cuboid 
using just 2 block positions: a minimum and maximum that form a diagonal
of the cuboid. Take a look at the definition of <code>Grid</code> and 
<code>DrawCuboid</code> in the same <code>MissionHandler.xsd</code> file. Both of them
are indeed what we would like to some extent; however, we don't really
need to have a <code>Grid</code> that is named nor do we need to specify block 
types and other block properties which the DrawCuboid requires. We thus
can define another type, namely <code>UnnamedGridDefinition</code>. </p>
<pre><code class="XML">  &lt;xs:complexType name=&quot;UnnamedGridDefinition&quot;&gt;
    &lt;xs:sequence&gt;
      &lt;xs:element name=&quot;min&quot; type=&quot;Pos&quot; /&gt;
      &lt;xs:element name=&quot;max&quot; type=&quot;Pos&quot; /&gt;
    &lt;/xs:sequence&gt;
  &lt;/xs:complexType&gt;
</code></pre>

<p>Note that the above type is complex and consists of a sequence with 
two elements, a <code>Pos</code> named <code>min</code> and a <code>Pos</code> named <code>max</code>
where <code>Pos</code> is on closer inspection (in the same <code>MissionHandler.xsd</code> file once again),
a 3-tuple defining x, y and z coordinates. Importantly, it should also 
be said that <code>xs:sequence</code> tags by default use a <code>minOccurs</code> and
<code>maxOccurs</code> of 1 thus required all <code>UnnamedGridDefinition</code> to 
have both a <code>max</code> and <code>min</code>.</p>
<p>Last, but certainly not least, we define the actual <code>RewardForStructureCopying</code>
Schema. It will take two <code>UnnamedGridDefinition</code>s defining the 
player structure bounds and built or goal structure bounds that are 
to be compared. Also, it will take two <code>DrawBlockBasedObjectType</code>s
that allow for providing visual feedback to agents and choosing the 
block properties to use when blocks are switched for visual feedback. 
For example, if the player places a block outside the player structure
boundary, upon block placement the type of the block could change to 
redstone (giving the block a red appearance) along with a negative 
reward. Finally, we have a <code>RewardDensityForBuildAndBreak</code> also. 
This gives the following code.</p>
<pre><code class="XML">  &lt;xs:element name=&quot;RewardForStructureCopying&quot;&gt;
    &lt;xs:complexType&gt;
      &lt;xs:sequence&gt;
        &lt;xs:element name=&quot;PlayerStructureBounds&quot; type=&quot;UnnamedGridDefinition&quot; /&gt;
        &lt;xs:element name=&quot;GoalStructureBounds&quot; type=&quot;UnnamedGridDefinition&quot; /&gt;
        &lt;xs:element name=&quot;BlockTypeOnCorrectPlacement&quot;
                    type=&quot;DrawBlockBasedObjectType&quot; nillable=&quot;true&quot; /&gt;
        &lt;xs:element name=&quot;BlockTypeOnIncorrectPlacement&quot;
                    type=&quot;DrawBlockBasedObjectType&quot; nillable=&quot;true&quot; /&gt;
        &lt;xs:element name=&quot;RewardDensity&quot; type=&quot;RewardDensityForBuildAndBreak&quot; /&gt;
      &lt;/xs:sequence&gt;
      &lt;xs:attributeGroup ref=&quot;RewardProducerAttributes&quot;/&gt;
    &lt;/xs:complexType&gt;
  &lt;/xs:element&gt;
</code></pre>

<p>The inclusion of the attributeGroup <code>RewardProducerAttributes</code> is 
yet unexplained. Examine the other Reward Producers, you will in fact 
see this attributeGroup in their definitions as well. The reason this 
is added is to allow for Reward Producers to share some attributes. In 
this case, we'd like to give Rewards a dimension. The idea is to be able
to associate certain types of rewards with a dimension. For example, 
we might want to associate rewards for reaching goal locations with 
say dimension 1 while rewards for defeating enemies with another 
dimension, giving a total of two dimensions and corresponding to 
two-dimensional vectors.</p>
<p>Upon adding the above three code snippets to the end of the Reward 
Producers section, we are now ready to start writing the Forge side code
and making changes to the Minecraft mod.</p>
<p>At this point, ensure that you have added the single line of code to 
your <code>Mission.xsd</code> file that adds a ref to <code>RewardForStructureCopying</code> as well
as the above three code snippets in the given order right at the end
of the Reward Producers section in the <code>MissionHandlers.xsd</code> file.</p>
<p>To test if everything is working right, try rebuilding the platform and 
in particular, try running the gradle task JAXB by executing: </p>
<ul>
<li>Windows: <code>gradlew jaxb</code></li>
<li>Linux/MacOS: <code>./gradlew jaxb</code></li>
</ul>
<p>The above will perform a task whereby necessary Java definitions of the 
schemas we just defined will be added. These will in fact be used 
shortly.</p></div>
        
    </div>

    <footer class="col-md-12 text-center">
        <hr>
        <p>
        <small>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a>.</p></small>
    </footer>

    <script src="../../js/jquery-1.10.2.min.js"></script>
    <script src="../../js/bootstrap-3.0.3.min.js"></script>
    <script src="../../js/highlight.pack.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <script>
    var base_url = '../..';
    </script>
    <script data-main="../../mkdocs/js/search.js" src="../../mkdocs/js/require.js"></script>
    <script src="../../js/base.js"></script>

    <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="Search Modal" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal">
                        <span aria-hidden="true">&times;</span>
                        <span class="sr-only">Close</span>
                    </button>
                    <h4 class="modal-title" id="exampleModalLabel">Search</h4>
                </div>
                <div class="modal-body">
                    <p>
                        From here you can search these documents. Enter your search terms below.
                    </p>
                    <form role="form">
                        <div class="form-group">
                            <input type="text" class="form-control" placeholder="Search..." id="mkdocs-search-query">
                        </div>
                    </form>
                    <div id="mkdocs-search-results"></div>
                </div>
                <div class="modal-footer">
                </div>
            </div>
        </div>
    </div>

    </body>

</html>
